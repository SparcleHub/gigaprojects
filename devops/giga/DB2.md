**Задание 1. Изучите структуру каталогов.**

\-Найдите каталог /var/lib/pgsql/data на сервере.  
\-Изучите содержимое подкаталогов и запишите, какие файлы находятся в каждом из них. Откройте и просмотрите файлы postgresql.conf и pg_hba.conf.  
![2034cc2e4a217ecdba1203e02623ebc8.png](../../_resources/2034cc2e4a217ecdba1203e02623ebc8.png)

**Задание** **2\. Изменение конфигурации.**

\-В файле postgresql.conf измените настройки логирования:  
\-Включите полное логирование запросов, изменив параметр log_statement на all.  
Установите ротацию логов, например, ежедневно (используйте log_rotation_age) и при достижении размера 10 МБ (log_rotation_size).  
\-Перезапустите сервер PostgreSQL и убедитесь, что настройки применились, проверив файлы логов.  
![2ef0984da426ab2989acbab97899e0f5.png](../../_resources/2ef0984da426ab2989acbab97899e0f5.png)  
<br/><br/>

**Задание** **3\. Настройка прав доступа.**

\-В файле pg_hba.conf добавьте правило для доступа к базе данных с IP-адреса 127.0.0.1 с использованием метода аутентификации md5.  
![c33e529ca852cc29f411876b362edc10.png](../../_resources/c33e529ca852cc29f411876b362edc10.png)

\-Перезапустите сервер PostgreSQL и подключитесь к базе данных с помощью пользователя, настроенного в предыдущем разделе, убедившись, что требуются пароль и соединение успешно.  
![58d8afba95b0305dfe9938d6e90eef3c.png](../../_resources/58d8afba95b0305dfe9938d6e90eef3c.png)  
<br/>

&nbsp;

**Задание 4. Проверка дискового пространства.**

Используйте команду df -h для мониторинга оставшегося места в каталоге данных.  
![be96e095abe585c6caae7e7517f67b1f.png](../../_resources/be96e095abe585c6caae7e7517f67b1f.png)

Создайте несколько тестовых таблиц с большим количеством строк (например, 100 тысяч записей) и проверьте, как это влияет на дисковое пространство.  
![050446e1c70665a3a1c256760a29ddbb.png](../../_resources/050446e1c70665a3a1c256760a29ddbb.png)  
![683837e5e1a03d770b9b37ae5f613940.png](../../_resources/683837e5e1a03d770b9b37ae5f613940.png)

Выполните команду VACUUM для этих таблиц, чтобы освободить неиспользуемое пространство, и проверьте разницу.  
![6021d89ce3f58b25431d2ebe1467e428.png](../../_resources/6021d89ce3f58b25431d2ebe1467e428.png)  
![f154a91c5e3dc0433f086e47674676d5.png](../../_resources/f154a91c5e3dc0433f086e47674676d5.png)

**Задание** **5\. Решение проблем аутентификации.**

Нарочно измените метод аутентификации для вашего пользователя в pg_hba.conf, например, на reject, и попытайтесь подключиться к базе. Запишите ошибку, которая будет выдана PostgreSQL.  
![15d4cdf9357c094241da0a06d3e56462.png](../../_resources/15d4cdf9357c094241da0a06d3e56462.png)

Восстановите метод аутентификации обратно на md5, подключитесь снова и убедитесь, что доступ снова работает.  
![b08cf5818937ce1cef1f8f8d6b4e9b4c.png](../../_resources/b08cf5818937ce1cef1f8f8d6b4e9b4c.png)  
<br/>

**Задание** **6\. Диагностика и решение deadlock.**

Создайте таблицу с несколькими строками и проведите параллельные транзакции, которые будут пытаться блокировать одни и те же строки (можно использовать команды BEGIN, LOCK, UPDATE).  
![87570e055948adf860bd9854738c589d.png](../../_resources/87570e055948adf860bd9854738c589d.png)  
<br/><br/>

Вызовите ситуацию deadlock и проследите, как PostgreSQL разрешает её. Просмотрите логи для диагностики возникшей блокировки.  
Примените команду SET deadlock_timeout и установите более низкое значение (например, 1 секунда), чтобы PostgreSQL быстрее обнаруживал deadlock.  
![32b92e76020e95cbace3c8e976b702f3.png](../../_resources/32b92e76020e95cbace3c8e976b702f3.png)